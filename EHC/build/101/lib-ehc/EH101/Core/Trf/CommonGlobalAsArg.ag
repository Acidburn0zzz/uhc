INCLUDE "Core/CommonPred.ag"
INCLUDE "Core/CommonLevLet.ag"
ATTR AllBind [ | | bindVarS, bindLamS USE {`Set.union`} {Set.empty}: FvS ]

SEM CBound
  | Bind        lhs         .   (bindVarS,bindLamS)
                                            =   if isJust @expr.mbLam
                                                then (Set.empty,Set.singleton @lhs.nm)
                                                else (Set.singleton @lhs.nm,Set.empty)

ATTR AllCodeNT [ varS, lamS: FvS | | ]

SEM CodeAGItf
  | AGItf       module      .   varS        =   Set.empty
                            .   lamS        =   Set.empty

SEM CExpr
  | Let         loc         .   varS        =   @lhs.varS `Set.union` @binds.bindVarS
                            .   lamS        =   @lhs.lamS `Set.union` @binds.bindLamS
  | Lam         loc         .   varS        =   @argNm `Set.insert` @lhs.varS

SEM CAlt
  | Alt         expr        .   varS        =   @lhs.varS `Set.union` Set.fromList @pat.nmL

